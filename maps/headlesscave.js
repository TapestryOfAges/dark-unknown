"use strict";

mappages["headlesscave"] = {};
mappages["headlesscave"].terrain = [];
 mappages["headlesscave"].terrain[0] = 'BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK';
 mappages["headlesscave"].terrain[1] = 'BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK';
 mappages["headlesscave"].terrain[2] = 'BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK';
 mappages["headlesscave"].terrain[3] = 'BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK';
 mappages["headlesscave"].terrain[4] = 'BK BK BK BK BK cw cw cw cw cw cw cw BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK';
 mappages["headlesscave"].terrain[5] = 'BK BK BK BK BK cw cf cf cf cf cf cw cw BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK';
 mappages["headlesscave"].terrain[6] = 'BK BK BK BK cw cw cf cf cf cf cf cf cw BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK';
 mappages["headlesscave"].terrain[7] = 'BK BK BK BK cw cf cf cf cf cf cf cf cw BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK';
 mappages["headlesscave"].terrain[8] = 'BK BK BK BK cw cw cf cf cf cf cf cf cw cw cw BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK';
 mappages["headlesscave"].terrain[9] = 'BK BK BK BK BK cw cw cw cf cf cf cf cf cf cw BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK';
mappages["headlesscave"].terrain[10] = 'BK BK BK BK BK BK BK cw cw cw cw cf cf cf cw cw BK BK BK BK BK BK BK BK BK BK BK BK BK BK';
mappages["headlesscave"].terrain[11] = 'BK BK BK BK BK BK BK BK BK BK cw cw cf cf cf cw cw cw cw BK BK BK BK BK BK BK BK BK BK BK';
mappages["headlesscave"].terrain[12] = 'BK BK BK BK BK BK BK BK BK BK BK cw cw cf cf cf cf cf cw cw cw cw cw cw cw cw cw BK BK BK';
mappages["headlesscave"].terrain[13] = 'BK BK BK BK BK BK BK BK BK BK BK BK cw cw cf cf cf cf cf cf cf cf cw cf cf cf cw cw cw cw';
mappages["headlesscave"].terrain[14] = 'BK BK BK BK BK BK BK BK BK BK BK BK BK cw cw cw cw cf cf cf cf cf cf cf cf cf cf cf cf cf';
mappages["headlesscave"].terrain[15] = 'BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK cw cw cw cf cf cf cf cf cf cf cf cf cf cf';
mappages["headlesscave"].terrain[16] = 'BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK cw cw cf cf cf cf cf cf cf cf cf cf cf cf';
mappages["headlesscave"].terrain[17] = 'BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK cw cw cf cf cf cf cf cw cf cf cf cf cw cw cw';
mappages["headlesscave"].terrain[18] = 'BK BK BK BK BK BK BK BK BK BK BK BK BK BK cw cw cf cf cf cf cf cw cw cw cw cw cw cw BK BK';
mappages["headlesscave"].terrain[19] = 'BK BK BK BK BK BK BK BK BK BK BK BK cw cw cw cf cf cf cf cf cw cw BK BK BK BK BK BK BK BK';
mappages["headlesscave"].terrain[20] = 'BK BK BK BK BK BK BK BK BK BK BK BK cw cf cf cf cf cf cw cw cw BK BK BK BK BK BK BK BK BK';
mappages["headlesscave"].terrain[21] = 'BK BK BK BK BK BK BK BK BK cw cw cw cw cf cf cw cw cw cw BK BK BK BK BK BK BK BK BK BK BK';
mappages["headlesscave"].terrain[22] = 'BK BK BK BK BK BK BK cw cw cw cf cf cf cf cw cw BK BK BK BK BK BK BK BK BK BK BK BK BK BK';
mappages["headlesscave"].terrain[23] = 'BK BK BK BK BK BK cw cw cf cf cf cf cf cw cw BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK';
mappages["headlesscave"].terrain[24] = 'BK BK BK BK BK BK cw cf cf cf cf cf cw cw BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK';
mappages["headlesscave"].terrain[25] = 'BK BK BK BK BK BK cw cf cf cf cf cf cw BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK';
mappages["headlesscave"].terrain[26] = 'BK BK BK BK BK BK cw cf cf cf cf cf cw BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK';
mappages["headlesscave"].terrain[27] = 'BK BK BK BK BK BK cw cw cw cw cw cw cw BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK';
mappages["headlesscave"].terrain[28] = 'BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK';
mappages["headlesscave"].terrain[29] = 'BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK';
mappages["headlesscave"].terrain[30] = 'BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK';
mappages["headlesscave"].terrain[31] = 'BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK BK';

mappages["headlesscave"].features = [];
mappages["headlesscave"].features[0] = {name : 'Chest', x : 6, y : 6, locked : 0, lootgroup : 'headlesscave', lootedid : 'headlesscave3'};
mappages["headlesscave"].features[1] = {name : 'Chest', x : 5, y : 7, locked : 0, lootgroup : 'headlesscave', lootedid : 'headlesscave2'};
mappages["headlesscave"].features[2] = {name : 'Chest', x : 8, y : 26, locked : 0, lootgroup : 'headlesscave', lootedid : 'headlesscave1'};


mappages["headlesscave"].npcs = [];
mappages["headlesscave"].npcs[0] = {name : 'GiantBatNPC', x : 25, y : 15};
mappages["headlesscave"].npcs[1] = {name : 'GiantBatNPC', x : 22, y : 15};
mappages["headlesscave"].npcs[2] = {name : 'HeadlessNPC', x : 16, y : 19};
mappages["headlesscave"].npcs[3] = {name : 'HeadlessNPC', x : 8, y : 24};
mappages["headlesscave"].npcs[4] = {name : 'HeadlessNPC', x : 10, y : 25};
mappages["headlesscave"].npcs[5] = {name : 'HeadlessNPC', x : 13, y : 12};
mappages["headlesscave"].npcs[6] = {name : 'HeadlessNPC', x : 7, y : 7};
mappages["headlesscave"].npcs[7] = {name : 'HeadlessNPC', x : 8, y : 5};
mappages["headlesscave"].npcs[8] = {name : 'HeadlessNPC', x : 9, y : 7};

mappages["headlesscave"].desc = "A Small Cave";
mappages["headlesscave"].music = 'Cave';
mappages["headlesscave"].exitmap = 'darkunknown';
mappages["headlesscave"].exitx = '48';
mappages["headlesscave"].exity = '78';
mappages["headlesscave"].wraps = '';
mappages["headlesscave"].enterx = '28';
mappages["headlesscave"].entery = '13';
mappages["headlesscave"].seeBelow = '';
mappages["headlesscave"].lightLevel = 'dark';
mappages["headlesscave"].alwaysRemember = '0';
mappages["headlesscave"].scale = '1';
mappages["headlesscave"].underground = '1';
mappages["headlesscave"].enterscript = '';
mappages["headlesscave"].entertestscript = '';
mappages["headlesscave"].exitscript = 'hc_check_clear';
mappages["headlesscave"].exittestscript = '';
mappages["headlesscave"].returnmap = 'darkunknown';
mappages["headlesscave"].returnx = '48';
mappages["headlesscave"].returny = '78';
mappages["headlesscave"].returninfused = '0';
mappages["headlesscave"].linkedMaps = [""];

mappages["headlesscave"].onload = function(mapref) {
  if ((gamestate.getMode() !== "loadgame") && (!DU.gameflags.getFlag("editor"))) {
    var allnpcs = mapref.npcs.getAll();
    for (var i=0;i<allnpcs.length;i++) {
      if (allnpcs[i].getName() === "HeadlessNPC") {
        mapref.deleteThing(allnpcs[i]);
      }
    }
  }
}

mappages["headlesscave"].hc_check_clear = function(mapref) {
  mapref.Exit = function(who,tomap,fromx,fromy,tox,toy) {
    var allnpcs = mapref.npcs.getAll();
    var anyheadlesses = 0;
    for (var i=0; i<allnpcs.length;i++) {
      if (allnpcs[i].getName() === "HeadlessNPC") {
        anyheadlesses = 1;
      }
    }
    if (!anyheadlesses) {
      DU.gameflags.setFlag("cave_cleared",1);
    }
  }
  
  return 1;
}
